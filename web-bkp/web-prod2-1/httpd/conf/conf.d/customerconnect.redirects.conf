
# Default Redirect to Home page
RewriteRule ^($|/$)           /home [R]

#MyVMware Refresh Default redirection for locale
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)($|/$) /$1/web/vmware/home [R]

#SEO changes
RewriteRule ^/web$               /home [R=301,L]
RewriteRule ^/web/vmware$        /home [R=301,L]
RewriteRule ^/web/vmware/$       /home [R=301,L]
RewriteRule ^/web/admin/login$   /login [R=301,L]


# Static Assets, should keep in sync with related rules in static_assets.conf
RewriteRule ^/static/(.*)        /www/assets/static/$1 [L]
RewriteRule ^/vmf/(.*)           /www/assets/vmf/$1 [L]
RewriteRule ^/lbweb              /www/assets/lbweb/index.html [L]
RewriteRule ^/ui/(.*)            /www/assets/ui/$1 [L]

## MIDAS Payment POD
<LocationMatch "^/midas/api/v1/auth/" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/midas/api/v1/auth/(.*)$ https://otc-payment-gateway-service.apps.itcna.vmware.com/psd/api/v1/auth/$1 [NC,P,L]

<LocationMatch "^/midas/v1/m4/api/dr/" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/midas/v1/m4/api/dr/(.*)$ https://vconnect.vmware.com/v1/m4/api/dr/$1 [NC,P,L]

# Used by customerconnect.vmware.com/go/get-free-esxi
RewriteRule ^/go/(.*)$             http://wwwa.vmware.com/go/$1 [P,L]

#Firewall is not opened for gsa and communities. Hence going through sso servers!
RewriteRule ^/gsa$                        /gsa/     [R]
RewriteRule ^/gsa/(.*)$                   http://search.vmware.com/$1 [QSA,L,P]
RewriteRule ^/communities_rest_api/(.*)$  http://communities.vmware.com/rpc/rest/$1 [L,P]

# My Vmware eppregister navigate to Maintenance page

RewriteRule ^/web/vmware/eppRegister$     https://www.vmware.com/page-not-found.html [R=301,L]
RewriteRule ^/group/vmware/eppRegister$   https://www.vmware.com/page-not-found.html [R=301,L]
RewriteRule ^/web/vmware/partnerenroll$   https://www.vmware.com/page-not-found.html [R=301,L]

##Scrapper redirect for MN-1153
RewriteRule  /content/dam/vmwaredesigns/scraper/non-responsive.css      https://www.vmware.com/content/dam/vmwaredesigns/scrapercontent/non-responsive.css  [R=302,L]
RewriteRule  /content/dam/vmwaredesigns/scraper/non-responsive.js       https://www.vmware.com/content/dam/vmwaredesigns/scrapercontent/non-responsive.js   [R=302,L]
RewriteRule  /bin/vmware/template/scrapper.us.js                        https://www.vmware.com/bin/vmware/template/scrapercontent.en.js [R=302,L]
RewriteRule  /bin/vmware/template/scrapper.de.js                        https://www.vmware.com/bin/vmware/template/scrapercontent.de.js [R=302,L]
RewriteRule  /bin/vmware/template/scrapper.fr.js                        https://www.vmware.com/bin/vmware/template/scrapercontent.fr.js [R=302,L]
RewriteRule  /bin/vmware/template/scrapper.cn.js                        https://www.vmware.com/bin/vmware/template/scrapercontent.cn.js [R=302,L]
RewriteRule  /bin/vmware/template/scrapper.jp.js                        https://www.vmware.com/bin/vmware/template/scrapercontent.jp.js [R=302,L]

#TKT2956804
RewriteCond %{QUERY_STRING} p=vmc-aws-19-new-hol
RewriteRule /en/web/vmware/evalcenter   /en/web/vmware/evalcenter?p=vmc-on-aws-lightning-20-hol [R=301,L]

RewriteCond %{QUERY_STRING} p=vmc-aws-19-new-hol
RewriteRule /de/web/vmware/evalcenter   /en/web/vmware/evalcenter?p=vmc-on-aws-lightning-20-hol [R=301,L]

RewriteCond %{QUERY_STRING} p=vmc-aws-19-new-hol
RewriteRule /fr/web/vmware/evalcenter   /en/web/vmware/evalcenter?p=vmc-on-aws-lightning-20-hol [R=301,L]

RewriteCond %{QUERY_STRING} p=vmc-aws-19-new-hol
RewriteRule /jp/web/vmware/evalcenter   /en/web/vmware/evalcenter?p=vmc-on-aws-lightning-20-hol [R=301,L]

#========= Rewrite Rules for MyVMware IDP begin ===============
RewriteCond %{REQUEST_URI} ^/group/vmware/idp/auth/reply?$
RewriteCond %{HTTP_COOKIE} ObSSOCookie [NC]
RewriteCond %{HTTP_COOKIE} !ObSSOCookie=loggedoutcontinue [NC]
RewriteRule ^/group/vmware/idp/auth/reply(.*)$	https://svcgw.vmware.com/services/idp/SAML/POST$1 [R,L]
#========= Rewrite Rules for MyVMware IDP end ===============

#7/15/2016 Zeus Launch
#==================Rewrite rules for AEM forwards=====================================
RewriteRule ^/content/dam/(.*)$                     http://www-cms-prod.vmware.com/content/dam/$1 [L,P]
RewriteRule ^/bin/vmware/template/(.*)$             http://www-cms-prod.vmware.com/bin/vmware/template/$1 [L,P]
RewriteRule ^/etc/clientlibs/vmwaredevapp/(.*)$     http://www-cms-prod.vmware.com/etc/clientlibs/vmwaredevapp/$1 [L,P]

#DMR-3275
RewriteRule ^(/(fr|de|cn|jp|kr))?/googlef66707900cef5be9.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/googlef66707900cef5be9.html [L,P]

#TKT2039904
RewriteRule ^/google1e2f6d16c45e6a16.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google1e2f6d16c45e6a16.html [L,P]
RewriteRule ^/google3af1b44afff7e0ac.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google3af1b44afff7e0ac.html [L,P]
RewriteRule ^/google5c491a1c527ac4ad.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google5c491a1c527ac4ad.html [L,P]
RewriteRule ^/google6dbcc7364418703b.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google6dbcc7364418703b.html [L,P]
RewriteRule ^/google7fb2acdae2b48b93.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google7fb2acdae2b48b93.html [L,P]
RewriteRule ^/google9c7ce657c2981098.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google9c7ce657c2981098.html [L,P]
RewriteRule ^/google48bb18397736f515.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google48bb18397736f515.html [L,P]
RewriteRule ^/google96d73a0d78a72337.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google96d73a0d78a72337.html [L,P]
RewriteRule ^/google00616f68b2a5ce2a.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google00616f68b2a5ce2a.html [L,P]
RewriteRule ^/google925dbb0cc46d131c.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google925dbb0cc46d131c.html [L,P]
RewriteRule ^/google6822cd6c4e6e416b.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google6822cd6c4e6e416b.html [L,P]
RewriteRule ^/google868567abd94da14b.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google868567abd94da14b.html [L,P]
RewriteRule ^/google453234389386a14a.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google453234389386a14a.html [L,P]
RewriteRule ^/googlea679ae8c24a0af03.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/googlea679ae8c24a0af03.html [L,P]
RewriteRule ^/googled4ea4333560c817e.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/googled4ea4333560c817e.html [L,P]
RewriteRule ^/googlee0be4c0f16e627bc.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/googlee0be4c0f16e627bc.html [L,P]
RewriteRule ^/googlee02b554e288045cc.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/googlee02b554e288045cc.html [L,P]
RewriteRule ^/googlee671c49271c6ee74.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/googlee671c49271c6ee74.html [L,P]
RewriteRule ^/googlef37b02c3af304100.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/googlef37b02c3af304100.html [L,P]
RewriteRule ^/googlef529d8509ff0a48a.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/googlef529d8509ff0a48a.html [L,P]
RewriteRule ^/googlef4102b4d0cb1ffc5.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/googlef4102b4d0cb1ffc5.html [L,P]
RewriteRule ^/google97debc0716c26fe8.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google97debc0716c26fe8.html [L,P]
RewriteRule ^/google744a6ac821966187.html$  http://www-cms-prod.vmware.com/content/dam/digitalmarketing/vmware/en/files/templates/inc/google744a6ac821966187.html [L,P]


#TKT2395273
RewriteCond %{QUERY_STRING} p=vmware-vsphere5-ent
RewriteRule ^/web/vmware/evalcenter$   https://customerconnect.vmware.com/en/web/vmware/evalcenter?p=vsphere-eval&src=WWW_vSphere_BM_Try_Eval_US_PLP_TNT_ExpB_DownloadNow&cid=70134000001K1bH  [R=301,L,QSD]

###Liferay Upgrade
RewriteRule ^/eppenroll.*$    /web/vmware/eppenroll [R=301,L]
RewriteRule ^/elaib.*$    /web/vmware/elaib [R=301,L]

## ASD-456 Fix
RewriteRule ^/c/portal/login    https://customerconnect.vmware.com/web/vmware/login [R=301,L]

# ========================== Multi Cloud TKG Migration Rule changes - Start ==========================#

<LocationMatch "^/channel/(auth/login|oauth2/code|protected/api/v2.0/navigation|public/api/v1.0/navigation|public/api/v2.0/navigation|api/v1.0/navigation|api/v2.0/navigation|public/api/v1.0/apigtw)" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/channel/(auth/login|oauth2/code|protected/api/v2.0/navigation|public/api/v1.0/navigation|public/api/v2.0/navigation|api/v1.0/navigation|api/v2.0/navigation|public/api/v1.0/apigtw)(.*)$ https://connect-apigateway.tkg.vmware.com/vmw/$1$2 [NC,L,P]

<LocationMatch "^/vmwauth/" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/vmwauth/(.*)$ https://oauth-server-basic-auth.tkg.vmware.com/$1 [NC,L,P]

<LocationMatch "^/channel/(api/v1.0/user|public/api/v1.0/user|api/v2.0/user|public/api/v2.0/user)" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/channel/(api/v1.0/user|public/api/v1.0/user|api/v2.0/user|public/api/v2.0/user)(.*)$ https://connect-apigateway.tkg.vmware.com/vmw/$1$2 [NC,L,P]

<LocationMatch "^/channel/(api/v1.0/entitlements/accounts|api/v1.0/ems/accountinfo)" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/channel/(api/v1.0/entitlements/accounts|api/v1.0/ems/accountinfo)(.*)$ https://connect-apigateway.tkg.vmware.com/vmw/$1$2 [NC,L,P]

<LocationMatch "^/channel/public/api/v1.0/(utility/localization|utility/marketing)" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/channel/public/api/v1.0/(utility/localization|utility/marketing)(.*)$ https://connect-apigateway.tkg.vmware.com/vmw/public/api/v2.0/$1$2 [NC,L,P]

<LocationMatch "^/channel/(api/v1.0/token|api/v1.0/otp)" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/channel/(api/v1.0/token|api/v1.0/otp)(.*)$ https://connect-apigateway.tkg.vmware.com/vmw/$1$2 [NC,L,P]

<LocationMatch "^/channel/(orchestrate/api|support/api|cloudconnector/api|api/v1.0/utility/dropdown|public/api/v1.0/globalsearch|api/v1/featureflags|crmservice/api|api/support/utility)" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/channel/(orchestrate/api|support/api|cloudconnector/api|api/v1.0/utility/dropdown|public/api/v1.0/globalsearch|api/v1/featureflags|crmservice/api|api/support/utility)(.*)$ https://connect-apigateway.tkg.vmware.com/vmw/$1$2 [NC,L,P]

<LocationMatch "^/channel/public/api/v1.0/(connectai/vassistant|connectai/liveagent)" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/channel/public/api/v1.0/(connectai/vassistant|connectai/liveagent)(.*)$ https://connect-apigateway.tkg.vmware.com/vmw/public/api/v1.0/$1$2 [NC,L,P]

<LocationMatch "^/channel/(api/v1.0/vassistant|api/v1.0/liveagent)" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/channel/(api/v1.0/vassistant|api/v1.0/liveagent)(.*)$ https://connect-apigateway.tkg.vmware.com/vmw/$1$2 [NC,L,P]

<LocationMatch "^/channel/(public/redeem/api/v1/organization|redeem/api/v1/pacs|redeem/api/v1/accountaddress|redeem/api/v1/address|redeem/api/v1/eaaddress|redeem/api/v1/previewpacs|redeem/api/v1/redemption/confirmation|redeem/api/v1/eligible|redeem/api/v1/details|redeem/api/v1/serials|redeem/api/v1/submit|redeem/api/v1/partners|redeem/api/v1/partial|redeem/api/v1/savepacswarnings|redeem/api/v1/validate)" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/channel/(public/redeem/api/v1/organization|redeem/api/v1/pacs|redeem/api/v1/accountaddress|redeem/api/v1/address|redeem/api/v1/eaaddress|redeem/api/v1/previewpacs|redeem/api/v1/redemption/confirmation|redeem/api/v1/eligible|redeem/api/v1/details|redeem/api/v1/serials|redeem/api/v1/submit|redeem/api/v1/partners|redeem/api/v1/partial|redeem/api/v1/savepacswarnings|redeem/api/v1/validate)(.*)$ https://connect-apigateway.tkg.vmware.com/vmw/$1$2 [NC,L,P]

<LocationMatch "^/channel/(api/v1.0/alerts)" >
   ProxyPreserveHost Off
   ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/channel/(api/v1.0/alerts)(.*)$ https://connect-apigateway.tkg.vmware.com/vmw/$1$2 [NC,L,P]

# ========================== Multi Cloud TKG Migration Rule changes - End ==========================#

##########MSM Changes - Start##############
<LocationMatch "^/channel/" >
ProxyPreserveHost Off
ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/channel(.*)$ https://apigateway-myvmware.apps.itcna.vmware.com/vmw$1 [NC,L,P]

#Fix for RED-421 - Missing referrer policy header
#Fix for MSM-3364 - Allow referrer URL to pass for OAuth
<If "%{HTTP_HOST} == 'customerconnect.vmware.com' && %{REQUEST_URI} !~ m#^/vmwauth\/*#">
    Header set Referrer-Policy "origin-when-cross-origin"
</If>
<Else>
    Header set Referrer-Policy "no-referrer-when-downgrade"
</Else>

#<LocationMatch "^/vmwauth/" >
#ProxyPreserveHost Off
#ProxyErrorOverride off
#</LocationMatch>
#RewriteRule ^/vmwauth(.*)$ https://oauth-server-basic.apps.itcna.vmware.com$1 [NC,L,P]

<LocationMatch "^/captcha/" >
ProxyPreserveHost Off
ProxyErrorOverride off
</LocationMatch>
RewriteRule ^/captcha$ /captcha/ [R]
RewriteRule ^/captcha/(.*)$ https://apigateway-myvmware.apps.itcna.vmware.com/captcha/$1 [QSA,L,P]

<LocationMatch "/web/vmware/downloads/get-download" >
  Header unset Etag
  FileEtag none
  Header set Cache-Control "max-age=0, public, must-revalidate"
</LocationMatch>

<LocationMatch "/web/vmware/downloads/details" >
  Header unset Etag
  FileEtag none
  Header set Cache-Control "max-age=0, public, must-revalidate"
</LocationMatch>

#============================= MyVMware Terms of use =================================#
RewriteCond %{REQUEST_URI}    ^/(en|de|fr|zh|ja|jp|cn)/terms-of-use
RewriteCond %{HTTP_COOKIE}    !TERMS_OF_USE
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/terms-of-use(.*)  https://customerconnect.vmware.com/channel/auth/login?locale=$1 [QSA,NC,L]

RewriteCond %{REQUEST_URI}    ^/terms-of-use
RewriteCond %{HTTP_COOKIE}    !TERMS_OF_USE
RewriteRule ^/terms-of-use(.*)  https://customerconnect.vmware.com/channel/auth/login$1 [NC,L]
#=================================================================================#

#====== Rewrite rules to check Access Token Cookie and redirect to login if not present ======================#

#============================= Old or Existing Group URLs - Kept for Reference =========================#
RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/(home|profile|downloads|my-licenses|license-key-tracker|users-permissions|support-entitlement|get-help|reports|all-services|my-account|epp-overview|alerts|support-contract-history|myeval|info|details|support-requests|subscription-services|billing-statements|patch|products|manage-funds|add-on-requests|my-products|my-downloads|all-products|support-contracts|my-subscription-funds|configure-service|configure-service|purchasesubscription|praxispromocode|vspp-air|my-funds|fund-products-redemption|app-launcher)
RewriteCond %{QUERY_STRING} ^(.*)
RewriteCond %{HTTP_COOKIE}  !(^|;\s*)VMWAUTH_SESSION=[0-9a-zA-Z\.\-_=]+ [OR]
RewriteCond %{HTTP_COOKIE}  !(^|;\s*)access_token=[0-9a-zA-Z\.\-_=]+
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/(home|profile|downloads|my-licenses|license-key-tracker|users-permissions|support-entitlement|get-help|reports|all-services|my-account|epp-overview|alerts|support-contract-history|myeval|info|details|support-requests|subscription-services|billing-statements|patch|products|manage-funds|add-on-requests|my-products|my-downloads|all-products|support-contracts|my-subscription-funds|configure-service|configure-service|purchasesubscription|praxispromocode|vspp-air|my-funds|fund-products-redemption|app-launcher)(.*)  https://customerconnect.vmware.com/channel/auth/login?locale=$1&resource_url=%{REQUEST_SCHEME}://%{HTTP_HOST}%{REQUEST_URI}?%1 [B,NC,L]

RewriteCond %{REQUEST_URI} ^/group/vmware/(home|profile|downloads|my-licenses|license-key-tracker|users-permissions|support-entitlement|get-help|reports|all-services|my-account|epp-overview|alerts|support-contract-history|myeval|info|details|support-requests|subscription-services|billing-statements|patch|products|manage-funds|add-on-requests|my-products|my-downloads|all-products|support-contracts|my-subscription-funds|configure-service|configure-service|purchasesubscription|praxispromocode|vspp-air|my-funds|fund-products-redemption|app-launcher)
RewriteCond %{QUERY_STRING} ^(.*)
RewriteCond %{HTTP_COOKIE}  !(^|;\s*)VMWAUTH_SESSION=[0-9a-zA-Z\.\-_=]+ [OR]
RewriteCond %{HTTP_COOKIE}  !(^|;\s*)access_token=[0-9a-zA-Z\.\-_=]+
RewriteRule ^/group/vmware/(home|profile|downloads|my-licenses|license-key-tracker|users-permissions|support-entitlement|get-help|reports|all-services|my-account|epp-overview|alerts|support-contract-history|myeval|info|details|support-requests|subscription-services|billing-statements|patch|products|manage-funds|add-on-requests|my-products|my-downloads|all-products|support-contracts|my-subscription-funds|configure-service|configure-service|purchasesubscription|praxispromocode|vspp-air|my-funds|fund-products-redemption|app-launcher)(.*)  https://customerconnect.vmware.com/channel/auth/login?resource_url=%{REQUEST_SCHEME}://%{HTTP_HOST}%{REQUEST_URI}?%1 [B,NC,L]

#============================= New Page URLs =========================#
RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/(dashboard|app-launcher|manage-user-profile|license-management|license-key-tracker|users-permissions|support-entitlements|my-funds|connect-success|all-notifications|patch|support|account-management|reports|order-history)
RewriteCond %{QUERY_STRING}   ^(.*)
RewriteCond %{HTTP_COOKIE}    !(^|;\s*)VMWAUTH_SESSION=[0-9a-zA-Z\.\-_=]+ [OR]
RewriteCond %{HTTP_COOKIE}    !(^|;\s*)access_token=[0-9a-zA-Z\.\-_=]+
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/(dashboard|app-launcher|manage-user-profile|license-management|license-key-tracker|users-permissions|support-entitlements|my-funds|connect-success|all-notifications|patch|support|account-management|reports|order-history)(.*)  https://customerconnect.vmware.com/channel/auth/login?locale=$1&resource_url=%{REQUEST_SCHEME}://%{HTTP_HOST}%{REQUEST_URI}?%1 [B,NC,L]

RewriteCond %{REQUEST_URI} ^/(dashboard|app-launcher|manage-user-profile|license-management|license-key-tracker|users-permissions|support-entitlements|my-funds|connect-success|all-notifications|patch|support|account-management|reports|order-history)
RewriteCond %{QUERY_STRING}   ^(.*)
RewriteCond %{HTTP_COOKIE}    !(^|;\s*)VMWAUTH_SESSION=[0-9a-zA-Z\.\-_=]+ [OR]
RewriteCond %{HTTP_COOKIE}    !(^|;\s*)access_token=[0-9a-zA-Z\.\-_=]+
RewriteRule ^/(dashboard|app-launcher|manage-user-profile|license-management|license-key-tracker|users-permissions|support-entitlements|my-funds|connect-success|all-notifications|patch|support|account-management|reports|order-history)(.*)  https://customerconnect.vmware.com/channel/auth/login?resource_url=%{REQUEST_SCHEME}://%{HTTP_HOST}%{REQUEST_URI}?%1 [B,NC,L]

# New OEM Portal URL
RewriteCond %{REQUEST_URI} ^/oem-portal
RewriteCond %{QUERY_STRING} ^(.*&)?((Name=)(.*))?$ [NC]
RewriteCond %{HTTP_COOKIE}  !(^|;\s*)VMWAUTH_SESSION=[0-9a-zA-Z\.\-_=]+ [OR]
RewriteCond %{HTTP_COOKIE}  !(^|;\s*)access_token=[0-9a-zA-Z\.\-_=]+
RewriteRule ^/oem-portal(.*) https://customerconnect.vmware.com/channel/auth/login?resource_url=%{REQUEST_SCHEME}://%{HTTP_HOST}%{REQUEST_URI}?%1%2 [CO=oem_partner:%4:.vmware.com,B,NC,L]


#==============================================================================================================#

RewriteRule ^/web/vmware/api/(.*)   /www/assets/ui/api/$1 [NC,L]


#==================== Browser Caching suppression & OAMAuthnCookie_GBL Cookie Generation =================#

#======== MyVMware Old Pages rules for reference =============#

<LocationMatch "^(/(en|de|fr|zh|ja|jp|cn))?/group/vmware/(home|profile|downloads|support-entitlement|my-licenses|users-permissions|license-key-tracker|my-funds|app-launcher)" >
  Header set Cache-Control "max-age=0, no-cache, no-store, must-revalidate"
  Header set Pragma "no-cache"
  Header set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
</LocationMatch>

<LocationMatch "^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/(home|registration)" >
  Header set Cache-Control "max-age=0, no-cache, no-store, must-revalidate"
  Header set Pragma "no-cache"
  Header set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
</LocationMatch>

<LocationMatch "^(/(en|de|fr|zh|ja|jp|cn))?/group/vmware/(home|profile|downloads|support-entitlement|my-licenses|users-permissions|license-key-tracker|my-funds|app-launcher)" >
  SetEnvIf Cookie "OAMAuthnCookie=([^;]+)" OAMAuthnCookieValue=$1
  SetEnvIf Cookie "OAMAuthnCookie=([^;]+)" OAMAuthnCookiePresent=1
  Header add Set-Cookie "OAMAuthnCookie_GBL=%{OAMAuthnCookieValue}e;domain=.vmware.com;path=/;secure;HttpOnly"
</LocationMatch>

#======== Customer Connect New Page URL rules for reference =============#

<LocationMatch "^(/(en|de|fr|zh|ja|jp|cn))?/(dashboard|app-launcher|manage-user-profile|license-management|license-key-tracker|users-permissions|support-entitlements|my-funds|downloads|connect-success|all-notifications|patch|support|account-management|reports|order-history)" >
  Header set Cache-Control "max-age=0, no-cache, no-store, must-revalidate"
  Header set Pragma "no-cache"
  Header set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
</LocationMatch>

<LocationMatch "^(/(en|de|fr|zh|ja|jp|cn))?/(home|login|account-registration|password-reset|forgot-password|activate-account|account-activated|activation-auth|mfa|troubleshoot-mfa|resetemailaddress)" >
  Header set Cache-Control "max-age=0, no-cache, no-store, must-revalidate"
  Header set Pragma "no-cache"
  Header set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
</LocationMatch>

<LocationMatch "^(/(en|de|fr|zh|ja|jp|cn))?/(dashboard|app-launcher|manage-user-profile|license-management|license-key-tracker|users-permissions|support-entitlements|my-funds|downloads|connect-success|all-notifications|patch|support|account-management|reports|order-history)" >
  SetEnvIf Cookie "OAMAuthnCookie=([^;]+)" OAMAuthnCookieValue=$1
  SetEnvIf Cookie "OAMAuthnCookie=([^;]+)" OAMAuthnCookiePresent=1
  Header add Set-Cookie "OAMAuthnCookie_GBL=%{OAMAuthnCookieValue}e;domain=.vmware.com;path=/;secure;HttpOnly" env=OAMAuthnCookiePresent
</LocationMatch>

#==============================================================================================================#

RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/web/vmware/downloads
RewriteCond %{HTTP_COOKIE}   access_token
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/web/vmware/downloads(.*)  https://customerconnect.vmware.com/$1/group/vmware/downloads$2 [NC,NE,L]

RewriteCond %{REQUEST_URI} ^/web/vmware/downloads
RewriteCond %{HTTP_COOKIE}   access_token
RewriteRule   ^/web/vmware/downloads(.*)  https://customerconnect.vmware.com/group/vmware/downloads$1 [NC,NE,L]

#======================= Rewrite rules for Customer Connect Downloads Custom Navigation ========================

#EPA-5431
RewriteRule ^/downloads/info/slug/infrastructure_as_a_service/vmware_cloud_on_aws/vmc$ /downloads/info/slug/infrastructure_as_a_service/vmware_cloud_on_premise_components/vmware_cloud [R=301,NE,NC]

#TKT2491416
RewriteRule ^/downloads/info/slug/desktop_end_user_computing/vmware_horizon_clients/1_0$ /en/downloads/info/slug/desktop_end_user_computing/vmware_horizon_clients/4_0 [R=301,NE,NC]

#TKT2424166
RewriteRule ^/en/downloads/info/slug/datacenter_cloud_infrastructure/vmware_vcloud_director/5_5  /en/downloads/info/slug/datacenter_cloud_infrastructure/vmware_vcloud_director/9_0  [R=301,NE,NC]

RewriteRule ^/en/downloads/info/slug/datacenter_cloud_infrastructure/vmware_vcloud_director/8_0  /en/downloads/info/slug/datacenter_cloud_infrastructure/vmware_vcloud_director/9_0  [R=301,NE,NC]

RewriteCond %{QUERY_STRING}  productId=356&downloadGroup=VCD_556
RewriteRule /downloads/details  https://customerconnect.vmware.com/downloads/info/slug/datacenter_cloud_infrastructure/vmware_vcloud_director/9_0 [R=301]

#TKT2649119
RewriteRule ^/en/downloads/info/slug/datacenter_cloud_infrastructure/vmware_vsphere_with_operations_management/6_7$ /en/web/vmware/evalcenter?p=vsphere-eval&src=WWW_us_VMW_XfK4FDRuqSPE01Y7isJw [R=301,NE,NC,L]

#TKT3337371
RewriteRule ^/downloads/info/slug/application_platform/downloads/pivotal   https://network.pivotal.io/  [R=301,L]
RewriteRule ^/downloads/info/slug/application_platform/downloads/pivotal#drivers_tools   https://network.pivotal.io/  [R=301,L]

RewriteRule ^/en/downloads/info/slug/application_platform/downloads/pivotal   https://network.pivotal.io/  [R=301,L]
RewriteRule ^/en/downloads/info/slug/application_platform/downloads/pivotal#drivers_tools   https://network.pivotal.io/  [R=301,L]

RewriteRule ^/downloads/info/slug/application_platform/downloads/pivotal   https://network.pivotal.io/  [R=301,L]
RewriteRule ^/downloads/info/slug/application_platform/downloads/pivotal#drivers_tools   https://network.pivotal.io/  [R=301,L]

#TKT2677731
RewriteRule ^/downloads/info/slug/desktop_end_user_computing/vmware_horizon_flex/1_12$   https://www.vmware.com/products/horizon.html [R=301,NE,NC,L]
RewriteRule ^/downloads/info/slug/desktop_end_user_computing/vmware_horizon_flex/1_11$   https://www.vmware.com/products/horizon.html [R=301,NE,NC,L]
RewriteRule ^/downloads/info/slug/desktop_end_user_computing/vmware_horizon_flex/1_10$   https://www.vmware.com/products/horizon.html [R=301,NE,NC,L]
RewriteRule ^/downloads/info/slug/desktop_end_user_computing/vmware_horizon_flex/1_9$    https://www.vmware.com/products/horizon.html [R=301,NE,NC,L]
RewriteRule ^/downloads/info/slug/desktop_end_user_computing/vmware_horizon_flex/1_8$    https://www.vmware.com/products/horizon.html [R=301,NE,NC,L]
RewriteRule ^/downloads/info/slug/desktop_end_user_computing/vmware_horizon_flex/1_7$    https://www.vmware.com/products/horizon.html [R=301,NE,NC,L]
RewriteRule ^/downloads/info/slug/desktop_end_user_computing/vmware_horizon_flex/1_6$    https://www.vmware.com/products/horizon.html [R=301,NE,NC,L]
RewriteRule ^/downloads/info/slug/desktop_end_user_computing/vmware_horizon_flex/1_5$    https://www.vmware.com/products/horizon.html [R=301,NE,NC,L]
RewriteRule ^/downloads/info/slug/desktop_end_user_computing/vmware_horizon_flex/1_0$    https://www.vmware.com/products/horizon.html [R=301,NE,NC,L]

#TKT2640844
RewriteCond %{QUERY_STRING} p=vsom-adv-18-hol&pvendorapp=zift&pid=ff808181560b36d401562da8d4c5517f&cid=70180000000wLR2&pwid=ff8081815bb5aecf015bca05263e4c40&cm_mmc=Vanity-_-Retail-_-NA-_-N&cm_mmc=Vanity-_-Publications-_-Menu-_-All&get=THE-NEW-MICROSOFT-OFFICE-2013&url=search/Networking-Products/Network-Optimization-Appliances/%252525252525253Fw=NB=&zPage=Products-Detail-e6e40132&zContent=VMware-Integrated-OpenStack---EN-ec6c40ca
RewriteRule ^/web/vmware/evalcenter$   https://www.vmware.com/go/try-vsphere-hol  [R=301,L,QSD]

#Ticket18694284901
RewriteRule ^/(en|de|fr|zh|ja|ko)/downloads/info/slug/infrastructure_operations_management/vmware_vrealize_operations/6_0    /$1/downloads/info/slug/infrastructure_operations_management/vmware_vrealize_operations/6_6 [R=301]
RewriteRule ^/downloads/info/slug/infrastructure_operations_management/vmware_vrealize_operations/6_0    /downloads/info/slug/infrastructure_operations_management/vmware_vrealize_operations/6_6 [R=301]

#TKT2053309#RFC#231344
RewriteRule ^/downloads/info/slug/application_platform/vmware_vfabric_data_director/2_0$    https://www.vmware.com/products/vfabric-data-director.html [R=301,L]

#TKT2055745
RewriteCond %{QUERY_STRING} downloadGroup=VFDD_101&productId=244&rPId=2223
RewriteRule /downloads/details  https://www.vmware.com/products/vfabric-data-director.html? [R=301,L]

RewriteCond %{QUERY_STRING} slug=application_platform/vmware_vfabric_data_director/1_0
RewriteRule /downloads/info  https://www.vmware.com/products/vfabric-data-director.html? [R=301,L]

##Backward compatibility
RewriteCond %{QUERY_STRING} ^slug=(.*)$
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/downloads/info$   https://customerconnect.vmware.com$1/downloads/info/slug/%1 [R=302,NC,QSD,L]

RewriteRule ^/downloads/i18n(.*)       /www/assets/ui/downloads/i18n/$1 [NC,L]
RewriteRule ^/downloads/assets(.*)     /www/assets/ui/downloads/assets/$1 [NC,L]
RewriteRule ^/downloads/(.*)\.js$      /www/assets/ui/downloads/$1.js [NC,L]
RewriteRule ^/downloads/(.*)\.css$     /www/assets/ui/downloads/$1.css [NC,L]
RewriteRule ^/downloads/(.*)\.map$     /www/assets/ui/downloads/$1.map [NC,L]
RewriteRule ^/downloads/favicon.ico https://customerconnect.vmware.com/files/templates/images/favicon.ico [R=301,L]

## KOREAN locale fixes (EPA-2019)
RewriteRule ^/(ko|kr)/downloads?/my-downloads         https://customerconnect.vmware.com/en/downloads/my-downloads
RewriteRule ^/(ko|kr)/downloads?/info/slug/(.*)$      https://customerconnect.vmware.com/en/downloads/info/slug/$2 [NC,L]
RewriteRule ^/(ko|kr)/downloads?/details$             https://customerconnect.vmware.com/en/downloads/details [NC,NE,QSA,L]
RewriteRule ^/(ko|kr)/downloads?/get-download$        https://customerconnect.vmware.com/en/downloads/get-download [NC,NE,QSA,L]
RewriteRule ^/(ko|kr)/downloads?/free$                https://customerconnect.vmware.com/en/downloads/free [R=302,NC,QSA,L]

#======================= END Rewrite rules for Customer Connect Downloads Custom Navigation ========================

#======================= Rewrite rules for Customer Connect Product Patches SPA start ========================
RewriteRule ^/patch/i18n(.*)       /www/assets/ui/product-patches/i18n/$1 [NC,L]
RewriteRule ^/patch/assets(.*)     /www/assets/ui/product-patches/assets/$1 [NC,L]
RewriteRule ^/patch/(.*)\.js$      /www/assets/ui/product-patches/$1.js [NC,L]
RewriteRule ^/patch/(.*)\.css$     /www/assets/ui/product-patches/$1.css [NC,L]
RewriteRule ^/patch/(.*)\.map$     /www/assets/ui/product-patches/$1.map [NC,L]
RewriteRule ^/patch/favicon.ico https://customerconnect.vmware.com/files/templates/images/favicon.ico [R=301,L]

##Index
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/patch   /www/assets/ui/product-patches/index.html [NC,L]

#======================= Rewrite rules for Product Patches SPA end ========================

#======================= Rewrite rules for Customer Connect Eval SPA start ========================
RewriteRule ^/evals-ui/i18n(.*)       /www/assets/ui/evals-ui/i18n/$1 [NC,L]
RewriteRule ^/evals-ui/assets(.*)     /www/assets/ui/evals-ui/assets/$1 [NC,L]
RewriteRule ^/evals-ui/(.*)\.js$      /www/assets/ui/evals-ui/$1.js [NC,L]
RewriteRule ^/evals-ui/(.*)\.css$     /www/assets/ui/evals-ui/$1.css [NC,L]
RewriteRule ^/evals-ui/(.*)\.map$     /www/assets/ui/evals-ui/$1.map [NC,L]
RewriteRule ^/evals-ui/favicon.ico https://customerconnect.vmware.com/files/templates/images/favicon.ico [R=301,L]

##Index
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/(evalcenter|eval)   /www/assets/ui/evals-ui/index.html [NC,L]

#======================= Rewrite rules for Eval SPA end ========================


#----EppPublicConfigurator OAMAuthnCookie changes starts----#

<LocationMatch "^/web/vmware/epppublicconfigurator" >
	<If "%{QUERY_STRING} =~ /_VM_internal=true/ && %{HTTP_REFERER} =~ m#^((https)://)+(www.vmware.com)/?$# && %{HTTP_REFERER}!~ m#^$#">
			Header add Set-Cookie "OAMAuthnCookie=INVALID;expires='Thu, 01 Jan 1970 00:00:00 GMT';Max-Age=0;domain=.vmware.com;Path=/;secure;HttpOnly"
	</If>
</LocationMatch>

#----EppPublicConfigurator OAMAuthnCookie changes ends----#

#==================== Rewrite rule for localization Based on pszGeoPref Cookie =================#

#============ /group/vmware/** pages for references ==================#
RewriteCond %{HTTP_COOKIE} pszGeoPref=([^;]+)
RewriteCond %{HTTP_COOKIE} !pszGeoPref=(us|en)
RewriteRule ^/group/vmware/(profile|terms-of-use|home|downloads|support-entitlement|my-licenses|users-permissions|license-key-tracker|my-funds|app-launcher)(.*)   /%1/group/vmware/$1$2 [R=302,L]

#============ /web/vmware/** pages for references ==================#
RewriteCond %{HTTP_COOKIE} pszGeoPref=([^;]+)
RewriteCond %{HTTP_COOKIE} !pszGeoPref=(us|en)
RewriteRule ^/web/vmware/(login|forgot-password|resetpassword|home|downloads|activationbeforeauth|activation|mfa|troubleshoot-mfa|resetemailaddress|registration)(.*)   /%1/web/vmware/$1$2 [R=301,L]

#============ New Customer Connect Protected URLs ==================#
RewriteCond %{HTTP_COOKIE} pszGeoPref=([^;]+)
RewriteCond %{HTTP_COOKIE} !pszGeoPref=(us|en)
RewriteRule ^/(dashboard|app-launcher|manage-user-profile|license-management|license-key-tracker|users-permissions|support-entitlements|my-funds|terms-of-use|connect-success|all-notifications|downloads|patch|account-management|reports|order-history)(.*)   https://customerconnect.vmware.com/%1/$1$2 [R=302,L]

#============ New Customer Connect Public URLs ==================#
RewriteCond %{HTTP_COOKIE} pszGeoPref=([^;]+)
RewriteCond %{HTTP_COOKIE} !pszGeoPref=(us|en)
RewriteRule ^/(home|login|account-registration|password-reset|forgot-password|activate-account|account-activated|activation-auth|mfa|troubleshoot-mfa|resetemailaddress)(.*)   https://customerconnect.vmware.com/%1/$1$2 [R=301,L]

#==============================================================================================#

#======================= Rewrite rules for Customer Connect Download SPA start ========================

##Index
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/downloads   /www/assets/ui/downloads/index.html [NC,L]

#======================= Rewrite rules for Download SPA end ========================

#======================== Rewrite rules for Support Entitlement Redirect ===============================#
RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contract-history
RewriteCond %{QUERY_STRING} (_VM_contractHistory|_contractHistoryPortlet_WAR_iceportal_contractHistory) [NC]
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contract-history(.*)  https://customerconnect.vmware.com/$1/support-entitlements?contractHistory=true [NC,L]

RewriteCond %{REQUEST_URI} ^/group/vmware/support-contract-history
RewriteCond %{QUERY_STRING} (_VM_contractHistory|_contractHistoryPortlet_WAR_iceportal_contractHistory) [NC]
RewriteRule ^/group/vmware/support-contract-history(.*)  https://customerconnect.vmware.com/support-entitlements?contractHistory=true [NC,L]

RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contract-history
RewriteCond %{QUERY_STRING} _VM_contractID [NC]
RewriteCond %{QUERY_STRING} _VM_contractStatus [NC]
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contract-history(.*)  https://customerconnect.vmware.com/$1/support-entitlements/view-contract-details [QSA,NC,L]

RewriteCond %{REQUEST_URI} ^/group/vmware/support-contract-history
RewriteCond %{QUERY_STRING} _VM_contractID [NC]
RewriteCond %{QUERY_STRING} _VM_contractStatus [NC]
RewriteRule ^/group/vmware/support-contract-history(.*)  https://customerconnect.vmware.com/support-entitlements/view-contract-details [QSA,NC,L]

RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contracts
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contracts(.*)  https://customerconnect.vmware.com/$1/support-entitlements [QSA,L]

RewriteCond %{REQUEST_URI} ^/group/vmware/support-contracts
RewriteRule ^/group/vmware/support-contracts(.*)  https://customerconnect.vmware.com/support-entitlements [QSA,L]

#=========================================================================================================#

#======================== Rewrite rules for Account Activities ===============================#
RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contract-history
RewriteCond %{QUERY_STRING} (activitiesLog|_contractHistoryPortlet_WAR_iceportal_activitiesLog) [NC]
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contract-history(.*)  https://customerconnect.vmware.com/$1/account-management [NC,L]

RewriteCond %{REQUEST_URI} ^/group/vmware/support-contract-history
RewriteCond %{QUERY_STRING} (activitiesLog|_contractHistoryPortlet_WAR_iceportal_activitiesLog) [NC]
RewriteRule ^/group/vmware/support-contract-history(.*)  https://customerconnect.vmware.com/account-management [NC,L]

RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contract-history
RewriteCond %{QUERY_STRING} ^$
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contract-history  https://customerconnect.vmware.com/$1/account-management [L]

RewriteCond %{REQUEST_URI} ^/group/vmware/support-contract-history
RewriteCond %{QUERY_STRING} ^$
RewriteRule ^/group/vmware/support-contract-history  https://customerconnect.vmware.com/account-management [L]
#=========================================================================================================#

#======================== Rewrite rules for Order History ===============================#
RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contract-history
RewriteCond %{QUERY_STRING} (_VM_orderHistory|orderHistory|_contractHistoryPortlet_WAR_iceportal_orderHistory) [NC]
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-contract-history(.*)  https://customerconnect.vmware.com/$1/order-history [NC,L]

RewriteCond %{REQUEST_URI} ^/group/vmware/support-contract-history
RewriteCond %{QUERY_STRING} (_VM_orderHistory|orderHistory|_contractHistoryPortlet_WAR_iceportal_orderHistory) [NC]
RewriteRule ^/group/vmware/support-contract-history(.*)  https://customerconnect.vmware.com/order-history [NC,L]

#=========================================================================================================#

#=========================== KB CORS Rules =================================================#

<LocationMatch "/group/vmware/userdetails" >
	SetEnvIf Origin "http(s)?://(kb.vmware.com|ikb.vmware.com)$" AccessControlAllowOrigin=$0
	Header add Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin
	Header set Access-Control-Allow-Credentials "true"
	Header set Access-Control-Max-Age "1000"
	Header set Access-Control-Allow-Headers "X-Requested-With, Content-Type, Origin, Authorization, Accept, Client-Security-Token, Accept-Encoding"
	Header set Access-Control-Allow-Methods "GET"
</LocationMatch>

<LocationMatch "/c/portal/logout" >
	SetEnvIf Origin "http(s)?://(kb.vmware.com|ikb.vmware.com)$" AccessControlAllowOrigin=$0
	Header add Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin
	Header set Access-Control-Allow-Credentials "true"
	Header set Access-Control-Max-Age "1000"
	Header set Access-Control-Allow-Headers "X-Requested-With, Content-Type, Origin, Authorization, Accept, Client-Security-Token, Accept-Encoding"
	Header set Access-Control-Allow-Methods "GET"
</LocationMatch>

#===============================================================================================#

RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/group/vmware/home   /www/assets/ui/home/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/group/vmware/terms-of-use   /www/assets/ui/home/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/group/vmware/support-entitlement   /www/assets/ui/home/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/group/vmware/license-key-tracker   /www/assets/ui/home/index.html [NC,L]
RewriteRule ^/group/vmware/i18n(.*)    /www/assets/ui/home/i18n/$1 [NC,L]
RewriteRule ^/group/vmware/assets(.*)  /www/assets/ui/home/assets/$1 [NC,L]
RewriteRule ^/group/vmware/(.*)\.js$   /www/assets/ui/home/$1.js [NC,L]
RewriteRule ^/group/vmware/(.*)\.css$  /www/assets/ui/home/$1.css [NC,L]
RewriteRule ^/group/vmware/(.*)\.map$  /www/assets/ui/home/$1.map [NC,L]
RewriteRule ^/group/vmware/favicon.ico https://customerconnect.vmware.com/files/templates/images/favicon.ico [R=301,L]

RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/home   /www/assets/ui/login/index.html [NC,L]
RewriteCond %{QUERY_STRING} !(p_p_resource_id)
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/login  /www/assets/ui/login/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/forgot-password  /www/assets/ui/login/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/resetpassword  /www/assets/ui/login/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/mfa  /www/assets/ui/login/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/troubleshoot-mfa  /www/assets/ui/login/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/invalid-action  /www/assets/ui/login/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/registration  /www/assets/ui/login/index.html [NC,L]

##Profile
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/group/vmware/profile   /www/assets/ui/home/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/resetemailaddress   /www/assets/ui/login/index.html [NC,L]

##Activation
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/inactiveaccount  /www/assets/ui/login/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/activationbeforeauth  /www/assets/ui/login/index.html [NC,L]
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/web/vmware/activation  /www/assets/ui/login/index.html [NC,L]

#Licenses
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/group/vmware/my-licenses   /www/assets/ui/home/index.html [NC,L]

##Login
RewriteRule ^/web/vmware/i18n(.*)  /www/assets/ui/login/i18n/$1 [NC,L]
RewriteRule ^/web/vmware/(.*)\.js$ /www/assets/ui/login/$1.js [NC,L]
RewriteRule ^/web/vmware/(.*)\.css$ /www/assets/ui/login/$1.css [NC,L]
RewriteRule ^/web/vmware/(.*)\.map$ /www/assets/ui/login/$1.map [NC,L]
RewriteRule ^/web/vmware/favicon.ico https://customerconnect.vmware.com/files/templates/images/favicon.ico [R=301,L]
RewriteRule ^/web/vmware/assets/(.*) /www/assets/ui/login/assets/$1 [NC,L]

#After Angular Upgrade - Login Redirects
RewriteRule ^/public/i18n(.*)  /www/assets/ui/login/i18n/$1 [NC,L]
RewriteRule ^/public/(.*)\.js$ /www/assets/ui/login/$1.js [NC,L]
RewriteRule ^/public/(.*)\.css$ /www/assets/ui/login/$1.css [NC,L]
RewriteRule ^/public/(.*)\.map$ /www/assets/ui/login/$1.map [NC,L]
RewriteRule ^/public/favicon.ico https://customerconnect.vmware.com/files/templates/images/favicon.ico [R=301,L]
RewriteRule ^/public/assets/(.*) /www/assets/ui/login/assets/$1 [NC,L]

#After Angular Upgrade - Home Redirects
RewriteRule ^/private/i18n(.*)  /www/assets/ui/home/i18n/$1 [NC,L]
RewriteRule ^/private/(.*)\.js$ /www/assets/ui/home/$1.js [NC,L]
RewriteRule ^/private/(.*)\.css$ /www/assets/ui/home/$1.css [NC,L]
RewriteRule ^/private/(.*)\.map$ /www/assets/ui/home/$1.map [NC,L]
RewriteRule ^/private/favicon.ico https://customerconnect.vmware.com/files/templates/images/favicon.ico [R=301,L]
RewriteRule ^/private/assets/(.*) /www/assets/ui/home/assets/$1 [NC,L]

#users-permissions
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/group/vmware/users-permissions   /www/assets/ui/home/index.html [NC,L]

##Fund-Management 2.0
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/group/vmware/my-funds   /www/assets/ui/home/index.html [NC,L]

#Customer Connect
RewriteRule ^(/(en|de|fr|zh|ja|jp|cn))?/group/vmware/app-launcher /www/assets/ui/home/index.html [NC,L]

############################################################################
# Customer Connect UI
############################################################################


##########MSM Changes - End#####################

####################### Customer Connect UI - TKG ##########################

<LocationMatch "^/(en|de|fr|zh|ja|jp|cn)/(home|invalid-action|login|mfa|troubleshoot-mfa|forgot-password|password-reset|activate-account|resetemailaddress|dashboard|account-registration|activation-auth|account-activated|account-management|all-notifications|order-history|reports|terms-of-use|privacy-policy|app-launcher|connect-success|manage-user-profile|my-funds|support-entitlements|users-permissions|license-key-tracker|license-management|support|oem-portal)(.*)" >
ProxyErrorOverride off
ProxyPreserveHost off
</LocationMatch>
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)?/(home|invalid-action|login|mfa|troubleshoot-mfa|forgot-password|password-reset|activate-account|resetemailaddress|dashboard|account-registration|activation-auth|account-activated|account-management|all-notifications|order-history|reports|terms-of-use|privacy-policy|app-launcher|connect-success|manage-user-profile|my-funds|support-entitlements|users-permissions|license-key-tracker|license-management|support|oem-portal)(.*) https://connect-ui-gateway.tkg.vmware.com/$2 [NC,L,P]

<LocationMatch "^/(home|invalid-action|login|mfa|troubleshoot-mfa|forgot-password|password-reset|activate-account|resetemailaddress|dashboard|account-registration|activation-auth|account-activated|account-management|all-notifications|order-history|reports|terms-of-use|privacy-policy|app-launcher|connect-success|manage-user-profile|my-funds|support-entitlements|users-permissions|license-key-tracker|license-management|support|oem-portal)(.*)" >
ProxyErrorOverride off
ProxyPreserveHost off
</LocationMatch>
RewriteRule ^/(home|invalid-action|login|mfa|troubleshoot-mfa|forgot-password|password-reset|activate-account|resetemailaddress|dashboard|account-registration|activation-auth|account-activated|account-management|all-notifications|order-history|reports|terms-of-use|privacy-policy|app-launcher|connect-success|manage-user-profile|my-funds|support-entitlements|users-permissions|license-key-tracker|license-management|support|oem-portal)(.*) https://connect-ui-gateway.tkg.vmware.com/$1 [NC,L,P]

<LocationMatch "^/(cc-landing|cc-login|cc-registration|cc-dashboard|cc-supportui|cc-account-management|cc-notifications|cc-order-history|cc-reports|cc-terms-of-use|cc-app-launcher|cc-connect-success|cc-fund-management|cc-profile|cc-support-contracts|cc-users-and-permissions|cc-license-management|cc-license-tracker|cc-oem-ui)(.*)" >
ProxyErrorOverride off
ProxyPreserveHost off
</LocationMatch>
RewriteRule ^/(cc-landing|cc-login|cc-registration|cc-dashboard|cc-supportui|cc-account-management|cc-notifications|cc-order-history|cc-reports|cc-terms-of-use|cc-app-launcher|cc-connect-success|cc-fund-management|cc-profile|cc-support-contracts|cc-users-and-permissions|cc-license-management|cc-license-tracker|cc-oem-ui)(.*) https://connect-ui-gateway.tkg.vmware.com/$1$2 [NC,L,P]

#=========================== END OF TKG Rules =============================#


#=========================== Support Request History Rules ============================================================#
RewriteCond %{REQUEST_URI} ^/group/vmware/support-requests
RewriteCond %{QUERY_STRING} !(^|&)_summaryRequests_WAR_itsupport_requestNumber=([^&]*)(&|$) [NC]
RewriteRule ^/group/vmware/support-requests  https://customerconnect.vmware.com/support/support-requests? [NC,L]

RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-requests
RewriteCond %{QUERY_STRING} !(^|&)_summaryRequests_WAR_itsupport_requestNumber=([^&]*)(&|$) [NC]
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-requests  https://customerconnect.vmware.com/$1/support/support-requests? [NC,L]

RewriteCond %{REQUEST_URI} ^/group/vmware/support-requests
RewriteCond %{QUERY_STRING} (^|&)_summaryRequests_WAR_itsupport_requestNumber=([^&]*)&?(.*)$ [NC]
RewriteRule ^/group/vmware/support-requests  https://customerconnect.vmware.com/support/support-request?id=%2 [NC,L]

RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-requests
RewriteCond %{QUERY_STRING} (^|&)_summaryRequests_WAR_itsupport_requestNumber=([^&]*)&?(.*)$ [NC]
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/support-requests  https://customerconnect.vmware.com/$1/support/support-request?id=%2 [NC,L]

#=========================== Connect Support Rules ============================================================#
#After Login - Proxy Pass
# <LocationMatch "^/(en|de|fr|zh|ja|jp|cn)/support(.*)" >
# ProxyErrorOverride off
# ProxyPreserveHost off
# </LocationMatch>
# RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/support/(description|contact|non-technical|non-technical-options|summary|success|support-requests|support-request)(.*) https://supporthub-getsupportui.apps.itcna.vmware.com$3 [NC,L,P]

# <LocationMatch "^/support(.*)" >
# ProxyErrorOverride off
# ProxyPreserveHost off
# </LocationMatch>
# RewriteRule ^/support/(description|contact|non-technical|non-technical-options|summary|success|support-requests|support-request)(.*) https://supporthub-getsupportui.apps.itcna.vmware.com$2 [NC,L,P]
# RewriteRule ^/support(.*) https://supporthub-getsupportui.apps.itcna.vmware.com$1 [NC,L,P]

#=========================== Connect Support ============================================================#

## CSP
RewriteRule ^/web/csp/login  /web/csp/invalid-action [R=301,L]

RewriteRule ^/web/csp/payment  /www/assets/ui/csp/payment.html [NC,L]
RewriteRule ^/web/csp/addEditCard(.*)  /www/assets/ui/csp/addEditCard.html$1 [NC,L]
RewriteRule ^/web/csp/i18n(.*)  /www/assets/ui/csp/i18n/$1 [NC,L]
RewriteRule ^/web/csp/(.*)\.js$ /www/assets/ui/csp/$1.js [NC,L]
RewriteRule ^/web/csp/(.*)\.css$ /www/assets/ui/csp/$1.css [NC,L]
RewriteRule ^/web/csp/(.*)\.map$ /www/assets/ui/csp/$1.map [NC,L]
RewriteRule ^/web/csp(.*)  /www/assets/ui/csp/index.html [NC,L]

#Success admin Proxy Pass
<LocationMatch "^/success-admin(.*)" >
ProxyErrorOverride off
ProxyPreserveHost off
Header set Access-Control-Allow-Origin "*"
</LocationMatch>
RewriteRule ^/success-admin(.*) https://acceleratorportal.vmware.com$1 [NC,L,P]


# =================== Exposing the file connetai.js to other portal without CORS error =================== #
<Files connectai.js>
   Header set Access-Control-Allow-Origin "*"
</Files>
# =================== End of connectai.js rule =================== #

# =================== Exposing the file navigation.js to other portal without CORS error =================== #
<Files navigation.js>
   Header set Access-Control-Allow-Origin "*"
</Files>
# =================== End of navigation.js rule =================== #

RewriteRule ^/partner-success(.*) http://www.vmware.com/partner-success$1 [R=302,L]

#Changes for CPP, TPP Decommisioning 
RewriteRule ^/web/vmware/cpp-landing$  https://www.vmware.com/page-not-found.html [R=301,L]
RewriteRule ^/web/vmware/tpp-landing$  https://www.vmware.com/page-not-found.html [R=301,L]