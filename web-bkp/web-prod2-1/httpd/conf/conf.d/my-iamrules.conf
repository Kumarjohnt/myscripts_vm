#========= Rewrite Rules for my-IAM BookMark =================

################################# Redirect rules for Product Patches Page #################################
RewriteRule   ^/(en|de|fr|zh|ja|jp|cn)/group/vmware/patch(.*)  https://my.vmware.com/$1/patch [NC,L]
RewriteRule   ^/group/vmware/patch(.*)  https://my.vmware.com/patch [NC,L]

################################# Redirect rules for Product Patches Page end #################################

#################### my-vmware login #################################

##########MSM Changes - Start###############
RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/web/vmware/home
RewriteCond %{QUERY_STRING}  !(BMCTX|OverrideRetryLimit|request_id) [NC,OR]
RewriteCond %{HTTP_COOKIE}  !OAMRequestContext_.* [NC]
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/web/vmware/home  https://my.vmware.com/$1/web/vmware/checksession [QSD,NC,L]

RewriteCond %{REQUEST_URI} ^/web/vmware/home
RewriteCond %{QUERY_STRING}  !(BMCTX|OverrideRetryLimit|request_id) [NC,OR]
RewriteCond %{HTTP_COOKIE}  !OAMRequestContext_.* [NC]
RewriteRule ^/web/vmware/home  https://my.vmware.com/web/vmware/checksession [NC,L]

RewriteCond %{REQUEST_URI} ^/(fr|de|jp|cn|en|kr|zh|ko|ja)/web/vmware/login
RewriteCond %{QUERY_STRING} !(resource_url|AUTH-ERR|crossfunctional|tracksn.portal|loginUserPortlet_WAR_itvmlogin|p_p_resource_id) [NC]
#RewriteRule  ^/(fr|de|jp|cn|en|kr|zh|ko|ja)/web/vmware/login https://my.vmware.com/channel/$1/auth/login$2 [NC,L] 
RewriteRule  ^/(fr|de|jp|cn|en|kr|zh|ko|ja)/web/vmware/login https://my.vmware.com/channel/auth/login?locale=$1 [QSA,NC,L]

RewriteCond %{REQUEST_URI} ^/web/vmware/login
RewriteCond %{QUERY_STRING} !(resource_url|vpp%252Fsecure%252Fpoints%252Fhome.do|betanext%252FshowPrivateMSBTA.portal|account%252Fsecure%252FproductRegistration.do|partnerEval%252Fsecure%252Fniagara%252FthirdPartyProductHome.do|%252Fuser%252Floginsso|p_p_resource_id) [NC]
RewriteCond %{QUERY_STRING} !(AUTH-ERR|crossfunctional|tracksn.portal|loginUserPortlet_WAR_itvmlogin) [NC]
RewriteRule   ^/web/vmware/login  https://my.vmware.com/channel/auth/login$1 [NC,L]

##########MSM Changes - End#####################

###################### my-admin login(vmwenrollmentflag) ############################
RewriteCond %{REQUEST_URI} ^/web/admin/login
RewriteCond %{HTTP_COOKIE} vmwenrollmentflag=2 [NC]
RewriteRule   ^/web/admin/login   https://my.vmware.com/group/vmware/home? [NC,L]

#################### my-admin login #################################
RewriteCond %{REQUEST_URI} ^/web/admin/login
RewriteCond %{QUERY_STRING} !(AUTH-ERR|crossfunctional) [NC]
RewriteCond %{HTTP_COOKIE}  !OAMRequestContext_.* [NC]
RewriteRule   ^/web/admin/login   https://my.vmware.com/group/admin/home? [NC,L]

#================= Communities and 3rd Party dependency on MyVMware home page redirection change===========
RewriteCond %{REQUEST_URI} /group/vmware/home
RewriteCond %{QUERY_STRING} redirectURL [NC]
RewriteCond %{QUERY_STRING} !redirectMyAirwatchURL [NC]
RewriteRule   /group/vmware/home(.*)  https://my.vmware.com/group/vmware/alogin$1 [QSA,NE,NC,L]

#================ Registration Fix for WDC Issue =====================================
RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/web/vmware/registration
RewriteCond %{QUERY_STRING} source=(jivp|oemp|evap|dwnp|LICP) [NC]
RewriteCond %{QUERY_STRING} !loggedin [NC]
#RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/web/vmware/registration(.*) https://my.vmware.com/channel/$1/auth/login?type=registration [QSA,NC,L]
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/web/vmware/registration(.*) https://my.vmware.com/channel/auth/login?locale=$1&type=registration [QSA,NC,L]

RewriteCond %{REQUEST_URI} ^/web/vmware/registration
RewriteCond %{QUERY_STRING} source=(jivp|oemp|evap|dwnp|LICP) [NC]
RewriteCond %{QUERY_STRING} !loggedin [NC]
RewriteRule ^/web/vmware/registration(.*) https://my.vmware.com/channel/auth/login?type=registration [QSA,NC,L]

################### Activation Rewrite Rules ############################
RewriteCond %{REQUEST_URI} ^/(en|de|fr|zh|ja|jp|cn)/web/vmware/activationbeforeauth
RewriteCond %{QUERY_STRING} token
#RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/web/vmware/activationbeforeauth(.*)  https://my.vmware.com/channel/$1/auth/login?type=activation [QSA,NC,L]
RewriteRule ^/(en|de|fr|zh|ja|jp|cn)/web/vmware/activationbeforeauth(.*)  https://my.vmware.com/channel/auth/login?locale=$1&type=activation [QSA,NC,L]

RewriteCond %{REQUEST_URI} /web/vmware/activationbeforeauth
RewriteCond %{QUERY_STRING} token
RewriteRule /web/vmware/activationbeforeauth(.*)  https://my.vmware.com/channel/auth/login?type=activation [QSA,NC,L]

################### Logout Rewrite Rules ############################
RewriteRule ^/web/vmware/logout(.*)$ https://my.vmware.com/vmwauth/logout$1 [NC,L]

#=================  Rewrite Rules for IAM BookMark  END =============================================================
